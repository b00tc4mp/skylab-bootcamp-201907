var q1 = [
  {
    letter: 'a',
    answer: 'abducir',
    status: 0,
    question:
      'CON LA A. Dicho de una supuesta criatura extraterrestre: Apoderarse de alguien'
  },
  {
    letter: 'b',
    answer: 'bingo',
    status: 0,
    question:
      "CON LA B. Juego que ha sacado de quicio a todos los 'Skylabers' en las sesiones de precurso"
  },
  {
    letter: 'c',
    answer: 'churumbel',
    status: 0,
    question: 'CON LA C. Niño, crío, bebé'
  },
  {
    letter: 'd',
    answer: 'diarrea',
    status: 0,
    question:
      'CON LA D. Anormalidad en la función del aparato digestivo caracterizada por frecuentes evacuaciones y su consistencia líquida'
  },
  {
    letter: 'e',
    answer: 'ectoplasma',
    status: 0,
    question:
      'CON LA E. Gelatinoso y se encuentra debajo de la membrana plasmática. Los cazafantasmas medían su radiación'
  },
  {
    letter: 'f',
    answer: 'facil',
    status: 0,
    question: 'CON LA F. Que no requiere gran esfuerzo, capacidad o dificultad'
  },
  {
    letter: 'g',
    answer: 'galaxia',
    status: 0,
    question:
      'CON LA G. Conjunto enorme de estrellas, polvo interestelar, gases y partículas'
  },
  {
    letter: 'h',
    answer: 'harakiri',
    status: 0,
    question: 'CON LA H. Suicidio ritual japonés por desentrañamiento'
  },
  {
    letter: 'i',
    answer: 'iglesia',
    status: 0,
    question: 'CON LA I. Templo cristiano'
  },
  {
    letter: 'j',
    answer: 'jabali',
    status: 0,
    question:
      "CON LA J. Variedad salvaje del cerdo que sale en la película 'El Rey León', de nombre Pumba"
  },
  {
    letter: 'k',
    answer: 'kamikaze',
    status: 0,
    question:
      'CON LA K. Persona que se juega la vida realizando una acción temeraria'
  },
  {
    letter: 'l',
    answer: 'licantropo',
    status: 0,
    question: 'CON LA L. Hombre lobo'
  },
  {
    letter: 'm',
    answer: 'misantropo',
    status: 0,
    question:
      'CON LA M. Persona que huye del trato con otras personas o siente gran aversión hacia ellas'
  },
  {
    letter: 'n',
    answer: 'necedad',
    status: 0,
    question: 'CON LA N. Demostración de poca inteligencia'
  },
  {
    letter: 'ñ',
    answer: 'señal',
    status: 0,
    question:
      'CONTIENE LA Ñ. Indicio que permite deducir algo de lo que no se tiene un conocimiento directo.'
  },
  {
    letter: 'o',
    answer: 'orco',
    status: 0,
    question:
      'CON LA O. Humanoide fantástico de apariencia terrible y bestial, piel de color verde creada por el escritor Tolkien'
  },
  {
    letter: 'p',
    answer: 'protoss',
    status: 0,
    question:
      'CON LA P. Raza ancestral tecnológicamente avanzada que se caracteriza por sus grandes poderes psíonicos del videojuego StarCraft'
  },
  {
    letter: 'q',
    answer: 'queso',
    status: 0,
    question:
      'CON LA Q. Producto obtenido por la maduración de la cuajada de la leche'
  },
  { letter: 'r', answer: 'raton', status: 0, question: 'CON LA R. Roedor' },
  {
    letter: 's',
    answer: 'stackoverflow',
    status: 0,
    question: 'CON LA S.Comunidad salvadora de todo desarrollador informático'
  },
  {
    letter: 't',
    answer: 'terminator',
    status: 0,
    question:
      'CON LA T. Película del director James Cameron que consolidó a Arnold Schwarzenegger como actor en 1984'
  },
  {
    letter: 'u',
    answer: 'unamuno',
    status: 0,
    question:
      "CON LA U. Escritor y filósofo español de la generación del 98 autor del libro 'Niebla' en 1914"
  },
  {
    letter: 'v',
    answer: 'vikingos',
    status: 0,
    question:
      'CON LA V. Nombre dado a los miembros de los pueblos nórdicos originarios de Escandinavia, famosos por sus incursiones y pillajes en Europa'
  },
  {
    letter: 'w',
    answer: 'sandwich',
    status: 0,
    question:
      'CONTIENE LA W. Emparedado hecho con dos rebanadas de pan entre las cuales se coloca jamón y queso'
  },
  {
    letter: 'x',
    answer: 'botox',
    status: 0,
    question: 'CONTIENE LA X. Toxina bacteriana utilizada en cirujía estética'
  },
  {
    letter: 'y',
    answer: 'peyote',
    status: 0,
    question:
      'CONTIENE LA Y. Pequeño cáctus conocido por sus alcaloides psicoactivos utilizado de forma ritual y medicinal por indígenas americanos'
  },
  {
    letter: 'z',
    answer: 'zen',
    status: 0,
    question:
      'CON LA Z. Escuela de budismo que busca la experiencia de la sabiduría más allá del discurso racional'
  }
];

var q2 = [
  {
    letter: 'a',
    answer: 'abrir',
    status: 0,
    question: 'CON LA A. Lo que no es cerrar'
  },
  {
    letter: 'b',
    answer: 'barco',
    status: 0,
    question: 'CON LA B. Medio de transporte acuático. Masculino'
  },
  {
    letter: 'c',
    answer: 'caspa',
    status: 0,
    question: 'CON LA C. Se deposita en los hombros si no usas H&S'
  },
  {
    letter: 'd',
    answer: 'diario',
    status: 0,
    question: 'CON LA D. Librito donde las adolescentes escriben sus peripecias'
  },
  { letter: 'e', answer: 'eden', status: 0, question: 'CON LA E. Paraiso' },
  {
    letter: 'f',
    answer: 'fuego',
    status: 0,
    question: 'CON LA F. Por el humo se sabe dónde está'
  },
  {
    letter: 'g',
    answer: 'galleta',
    status: 0,
    question: 'CON LA G. Se unta en la leche y se da en la cara'
  },
  {
    letter: 'h',
    answer: 'habano',
    status: 0,
    question: 'CON LA H. El mejor puro del mundo'
  },
  {
    letter: 'i',
    answer: 'ingles',
    status: 0,
    question: 'CON LA I. El idioma de Shakespeare'
  },
  {
    letter: 'j',
    answer: 'jorge',
    status: 0,
    question:
      'CON LA J. Así se llama el developer in the making que ha escrito estas preguntas'
  },
  { letter: 'k', answer: 'kilo', status: 0, question: 'CON LA K. Mil gramos' },
  { letter: 'l', answer: 'lobo', status: 0, question: 'CON LA L. Auuuuuuuu' },
  {
    letter: 'm',
    answer: 'mudo',
    status: 0,
    question: 'CON LA M. Persona que no puede hablar'
  },
  {
    letter: 'n',
    answer: 'nariz',
    status: 0,
    question: 'CON LA N. Órgano que hace uso del olfato'
  },
  {
    letter: 'ñ',
    answer: 'sueño',
    status: 0,
    question: 'CONTIENE LA Ñ. Se tiene cuando se duerme'
  },
  {
    letter: 'o',
    answer: 'oro',
    status: 0,
    question: 'CON LA O. Metal precioso amarillento'
  },
  {
    letter: 'p',
    answer: 'publico',
    status: 0,
    question: 'CON LA P. Lo contrario a privado'
  },
  {
    letter: 'q',
    answer: 'quemar',
    status: 0,
    question: 'CON LA Q. Prender fuego'
  },
  {
    letter: 'r',
    answer: 'renta',
    status: 0,
    question: 'CON LA R. Se declara a Hacienda'
  },
  {
    letter: 's',
    answer: 'superman',
    status: 0,
    question: 'CON LA S. Clark Kent sin gafas'
  },
  {
    letter: 't',
    answer: 'telefono',
    status: 0,
    question: 'CON LA T. Aparato para hacer llamadas y fotos'
  },
  {
    letter: 'u',
    answer: 'util',
    status: 0,
    question: 'CON LA U. Opuesto a inútil'
  },
  {
    letter: 'v',
    answer: 'valiente',
    status: 0,
    question: 'CON LA V. Persona gallarda y sin miedo'
  },
  {
    letter: 'w',
    answer: 'kawasaki',
    status: 0,
    question: 'CONTIENE LA W. Fabricante japonés de vehículos a motor'
  },
  {
    letter: 'x',
    answer: 'taxi',
    status: 0,
    question:
      'CONTIENE LA X. Automóvil de servicio público para el transporte de personas'
  },
  {
    letter: 'y',
    answer: 'cayena',
    status: 0,
    question: 'CONTIENE LA Y. Pimiento pequeño muy picante'
  },
  {
    letter: 'z',
    answer: 'zaragoza',
    status: 0,
    question: 'CON LA Z. Ciudad inmortal'
  }
];

var q3 = [
  {
    letter: 'a',
    answer: 'amen',
    status: 0,
    question:
      'CON LA A. Palabra usada por los cristianos al terminar sus oraciones'
  },
  {
    letter: 'b',
    answer: 'berrido',
    status: 0,
    question: 'CON LA B. Grito, alarido'
  },
  {
    letter: 'c',
    answer: 'casa',
    status: 0,
    question: 'CON LA C. Construcción usada a modo de vivienda'
  },
  {
    letter: 'd',
    answer: 'dardo',
    status: 0,
    question:
      'CON LA D. Proyectil de punta afilada y que requiere precisión en el lanzamiento'
  },
  {
    letter: 'e',
    answer: 'elenco',
    status: 0,
    question: 'CON LA E. Conjunto de actores que forman una compañia'
  },
  {
    letter: 'f',
    answer: 'felicidad',
    status: 0,
    question: 'CON LA F. Estado emocional placentero'
  },
  {
    letter: 'g',
    answer: 'gol',
    status: 0,
    question: 'CON LA G. Un punto en el fútbol'
  },
  {
    letter: 'h',
    answer: 'hora',
    status: 0,
    question: 'CON LA H. Sesenta minutos'
  },
  {
    letter: 'i',
    answer: 'idiota',
    status: 0,
    question: 'CON LA I. Bruto, poco inteligente, imbécil.'
  },
  {
    letter: 'j',
    answer: 'jamon',
    status: 0,
    question: 'CON LA J. Pata de cerdo curada'
  },
  {
    letter: 'k',
    answer: 'kas',
    status: 0,
    question: 'CON LA K. Marca de bebidas refrescantes de estractos'
  },
  {
    letter: 'l',
    answer: 'lento',
    status: 0,
    question: 'CON LA L. No es rápido'
  },
  {
    letter: 'm',
    answer: 'maria',
    status: 0,
    question: 'CON LA M. La Virgen Santísima'
  },
  {
    letter: 'n',
    answer: 'notable',
    status: 0,
    question: 'CON LA N. Entre bien y sobresaliente'
  },
  {
    letter: 'ñ',
    answer: 'caña',
    status: 0,
    question: 'CONTIENE LA Ñ. Vaso de cerveza, palo frágil'
  },
  {
    letter: 'o',
    answer: 'ortopedia',
    status: 0,
    question:
      'CON LA O. Tienda en la que se venden prótesis y elementos que ayudan a las personas con discapacidades físicas'
  },
  { letter: 'p', answer: 'pato', status: 0, question: 'CON LA P. Cuak Cuak!' },
  {
    letter: 'q',
    answer: 'quiebra',
    status: 0,
    question: 'CON LA Q. Bancarrota económica'
  },
  {
    letter: 'r',
    answer: 'romano',
    status: 0,
    question: 'CON LA R. Ciudadano de Roma'
  },
  {
    letter: 's',
    answer: 'sandalia',
    status: 0,
    question: 'CON LA S. Zapato abierto para el buen tiempo'
  },
  {
    letter: 't',
    answer: 'tarde',
    status: 0,
    question: 'CON LA T. Entre la mañana y la noche'
  },
  {
    letter: 'u',
    answer: 'ufo',
    status: 0,
    question: 'CON LA U. En ingles: onvi'
  },
  {
    letter: 'v',
    answer: 'valencia',
    status: 0,
    question: 'CON LA V. Las mejores paellas se hacen en ...'
  },
  {
    letter: 'w',
    answer: 'sandwich',
    status: 0,
    question:
      'CONTIENE LA W. Emparedado hecho con dos rebanadas de pan entre las cuales se coloca jamón y queso'
  },
  {
    letter: 'x',
    answer: 'xilofono',
    status: 0,
    question: 'CONTIENE LA X. Instrumento musical'
  },
  {
    letter: 'y',
    answer: 'yeso',
    status: 0,
    question:
      'CON LA Y. Polvo blanco que mezclado con agua se usa en albañilería'
  },
  {
    letter: 'z',
    answer: 'zorro',
    status: 0,
    question: 'CON LA Z. Espadachín mexicano con gorro y antifaz'
  }
];

// Array de objetos con usuarios y sus puntuaciones
var users = [
  {
    name: 'Andreea',
    points: 14
  },
  {
    name: 'Tommy',
    points: 10
  },
  {
    name: 'Rodrigo',
    points: 6
  }
];

// selector variables

let startJs = document.querySelector('#start');

let questionJs = document.querySelector('#question');
let currentAnswerJs = document.querySelector('#inputAnswer');
let rosco = document.querySelector('.rosco');
let buttonJs = document.querySelector('#buttonJs');
let pasapalabraButton = document.getElementById('pasapalabra');
let welcomeJs = document.querySelector('.welcome');
let aciertos = document.querySelector('#aciertos');
let fallos = document.querySelector('#fallos');
let usuario = document.querySelector('#usuario');
let exitJs = document.querySelector('#exit');
let scoresJS = document.querySelector('.scores');
let quitter = document.querySelector('.quitter');
let righties = document.querySelector('#righties');
let letraz = document.querySelector('.letraz');
let name = document.querySelector('.nombre');

let letterA = document.querySelector('#letterA');
let letterB = document.querySelector('#letterB');
let letterC = document.querySelector('#letterC');
let letterD = document.querySelector('#letterD');
let letterE = document.querySelector('#letterE');
let letterF = document.querySelector('#letterF');
let letterG = document.querySelector('#letterG');
let letterH = document.querySelector('#letterH');
let letterI = document.querySelector('#letterI');
let letterJ = document.querySelector('#letterJ');
let letterK = document.querySelector('#letterK');
let letterL = document.querySelector('#letterL');
let letterM = document.querySelector('#letterM');
let letterN = document.querySelector('#letterN');
let letterÑ = document.querySelector('#letterÑ');
let letterO = document.querySelector('#letterO');
let letterP = document.querySelector('#letterP');
let letterQ = document.querySelector('#letterQ');
let letterR = document.querySelector('#letterR');
let letterS = document.querySelector('#letterS');
let letterT = document.querySelector('#letterT');
let letterU = document.querySelector('#letterU');
let letterV = document.querySelector('#letterV');
let letterW = document.querySelector('#letterW');
let letterX = document.querySelector('#letterX');
let letterY = document.querySelector('#letterY');
let letterZ = document.querySelector('#letterZ');

// Array con las variables de selección

let letrasJS = [];

q1.forEach(function(item) {
  letrasJS.push(eval('letter' + `${item.letter.toUpperCase()}`));
});

// misc variables

var questionList = [q1, q2, q3];
var questions = [];

var currentAnswer;

correctAnswers = 0;
wrongAnswers = 0;
let user = '';

let testStatus;

// Funcionalidad del botón start
// Llama a welcome() con un click
// Resetea aplicación con otro click

document.querySelector('.nombre').focus();

startJs.style.display = 'none';

startJs.addEventListener('click', function() {
  if (this.innerHTML === 'START') {
    this.innerHTML = 'RESET';
    // iniciamos el contador
    timer();
    welcome();
  } else {
    document.location.reload(true);
  }
});

function showButton() {
  user = name.value;
  if (user != '') {
    timer();
    startJs.style.display = 'block';
    startJs.innerHTML = 'RESET';

    welcome();
  }
}

// Tomamos el nombre de usuario y si es correcto generamos lista de preguntas

function welcome() {
  rosco.style.display = 'block';
  welcomeJs.style.display = 'none';

  usuario.innerHTML = user.toUpperCase();
  gameInit();
}

function gameInit() {
  //Generamos un array de preguntas aleatorias
  for (var i = 0; i < q1.length; i++) {
    questions.push(questionList[Math.floor(Math.random() * 3)][i]);
  }
  // tratamos de lanzar la primera pregunta
  check();
}

// Funciones que controlan el .status de las preguntas
// status 0: unanswered
// status 1: right
// status 2: wrong
// status 3: pasapalabra

// Devuelve 0 cuando todas las preguntas se han contestado bien o mal.
// >0 si hay alguna en pasapalabra o por contestar

let pasadas = [];
let acertadas = [];
let incorrectas = [];

function checkStatus() {
  testStatus = 0;
  pasadas = [];

  questions.forEach(function(num) {
    if (num.status != 1 && num.status != 2) {
      testStatus++;
    }

    if (num.status == 3) {
      pasadas.push(num.letter);
    }
  });
}

// Función a la que se llama al iniciar una pregunta, en caso de haber
// disponibles la lanza, de lo contrario exit()

function check() {
  //debugger;
  checkStatus();
  if (testStatus > 0) {
    question();
  } else {
    scores();
  }
}

current = 0; // lleva la cuenta de en qué index del array de preguntas nos encontramos

// Función para poner el foco en la casilla de texto

function setFocusToAnswer() {
  document.querySelector('#inputAnswer').focus();
}

// Función para usar el enter

buttonJs.addEventListener('click', function() {
  currentAnswer = document.querySelector('#inputAnswer').value;
  // Condicional que elimina un espacio en blanco del index 0 de la respuesta tras haber usado el espacio para pasar palabra
  if (currentAnswer[0] === ' ') {
    currentAnswer = currentAnswer.substr(1, currentAnswer.length - 1);
  }
  if (currentAnswer != '') {
    // Cuando se introduce una respuesta, limpiamos el input
    document.getElementById('inputAnswer').value = '';
    // y llamamos questionContinue() para evaluarla
    questionContinue();
  }
});

// Función para usar espacio como pasapalabra

currentAnswerJs.addEventListener('keydown', function() {
  // Si pulsamos espacio
  if (event.keyCode == 32) {
    // limpiamos el input
    document.getElementById('inputAnswer').value = '';
    // pasamos pasapalabra como respuesta y evaluamos
    currentAnswer = 'pasapalabra';
    questionContinue();
  }
});

function question() {
  setFocusToAnswer();

  // Comprueba si la pregunta está sin contestar o en pasapalabra y en caso afirmativo la muestra
  // por pantalla.
  if (questions[current].status == 0 || questions[current].status == 3) {
    questionJs.innerHTML = questions[current].question;

    letrasJS[current].style.background = 'rgba(100, 13, 172, 0.739)';
    // si la pregunta está en estado correcto o incorrecto, pasa a la siguiente.
  } else {
    current++;
    check();
  }
}

function questionContinue() {
  // Respuestas inválidas o END
  if (currentAnswer == null || currentAnswer.toLowerCase() == 'end') {
    quitterF();
  } else if (currentAnswer == '') {
    alert('Please enter your answer');
    check();

    // Respuesta pasapalabra, cambia status a 3
  } else if (currentAnswer.toLowerCase() == 'pasapalabra') {
    // cambia el color de la letra a amarillo
    //debugger;
    letrasJS[current].style.background = 'rgba(231, 216, 82, 0.739)';

    // Comprueba si es la primera vuelta y si es la Z, de ser así asigna
    // el estado que corresponde y vuelve a empezar por la A

    if (questions[current].status != 3 && current == questions.length - 1) {
      questions[current].status = 3;
      current = 0;
      check();
      // Si no es la primera vuelta pero es la última de las letras que están
      // en status pasapalabra, vuelve a empezar por la A
    } else if (
      questions[current].status == 3 &&
      questions[current].letter == pasadas[pasadas.length - 1]
    ) {
      current = 0;
      check();
      // Si es una letra que estaba en pasapalabra pero no es la última,
      // suma 1 a current
    } else {
      questions[current].status = 3;
      current++;
      check();
    }

    // Respuesta correcta, cambia status a 1
  } else if (currentAnswer.toLowerCase() == questions[current].answer) {
    letrasJS[current].style.background = 'rgba(9, 255, 9, 0.335)';
    correctAnswers++;
    aciertos.innerHTML = correctAnswers;

    if (questions[current].status != 1 && current == questions.length - 1) {
      questions[current].status = 1;
      current = 0;
      check();
    } else if (
      questions[current].status == 3 &&
      questions[current].letter == pasadas[pasadas.length - 1]
    ) {
      questions[current].status = 1;
      current = 0;
      check();
    } else {
      questions[current].status = 1;
      current++;
      check();
    }

    // Respuesta incorrecta, cambia status a 2
  } else if (currentAnswer.toLowerCase() != questions[current].answer) {
    //cambia el color de la letra a rojo
    letrasJS[current].style.background = 'rgba(251, 0, 42, 0.685)';
    // suma una respuesta incorrecta y la muestra
    wrongAnswers++;
    fallos.innerHTML = wrongAnswers;

    if (questions[current].status != 2 && current == questions.length - 1) {
      questions[current].status = 2;
      current = 0;
      check();
    } else if (
      questions[current].status == 3 &&
      questions[current].letter == pasadas[pasadas.length - 1]
    ) {
      questions[current].status = 2;
      current = 0;
      check();
    } else {
      questions[current].status = 2;
      current++;
      check();
    }
  }
}

function scores() {
  // Ordenmos el array de usuarios por puntos descendentes
  users.push({ name: user, points: correctAnswers });
  users.sort(function(a, b) {
    return b.points - a.points;
  });

  // ocultamos lo que no interesa, mostramos lo que interesa

  scoresJS.style.display = 'block';
  rosco.style.display = 'none';

  // vaciamos el hueco

  document.getElementById('generated').innerHTML = '';

  for (var i = 0; i < users.length; i++) {
    document.getElementById('generated').innerHTML +=
      'Rank ' +
      users.indexOf(users[i]) +
      ': ' +
      users[i].name +
      ' with ' +
      users[i].points +
      ' points.' +
      '<br>';
  }
}

// Mostramos pantalla especial en caso de abandono con 'end'

function quitterF() {
  righties.innerHTML = correctAnswers;
  quitter.style.display = 'block';
  rosco.style.display = 'none';
}

function timer() {
  var sec = 179;
  setInterval(function() {
    document.getElementById('timer').innerHTML =
      'Tiempo restante: ' + sec + ' s';
    if (sec > 0) {
      sec--;
    }
    if (sec == 00) {
      document.getElementById('timer').innerHTML = 'Time is up!';
      clearInterval();
      buttonJs.style.display = 'none';
      document.querySelector('#inputAnswer').style.display = 'none';
    }
  }, 1000);
}
